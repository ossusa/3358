@model SitefinityWebApp.Mvc.Models.IAFCHandBookResourceModel

<p>MY HANDBOOK</p>

<div>
	<a href="~/iafchandbookhome/my-handbook"> MY HNADBOOK </a> >
	<a href="@Model.ResourceDetails.Category.MyHandBookParentCategoryUrl"> @Model.ResourceDetails.Category.ParentCategoryTitle</a> >
	<a href="@Model.ResourceDetails.Category.MyHandBookCategoryUrl"> @Model.ResourceDetails.Category.CategoryTitle</a> >
	@Model.ResourceDetails.ResourceTitle
</div>

<div>
	@if (Model.ResourceDetails.VideoEmbedCode != null && Model.ResourceDetails.VideoEmbedCode != String.Empty)
	{
		<iframe width="420" height="315"
				src=@Model.ResourceDetails.VideoEmbedCode></iframe>
	}
</div>
<div>
	<h5>@Model.ResourceDetails.ResourceTitle</h5>
	<p>@Model.ResourceDetails.ResourceDescription</p>
</div>

<div id="@string.Format("{0}_{1}", "markAsComplete" , Model.Id.ToString())">
	<div id="markAsComplete">
		@if (Model.IsResourceCompleted == true)
		{
			<span>Completed</span>
		}
		else
		{
			<button type="button" class="markAsCompleteBtn" data-id="@Model.Id"> Mark As Complete </button>
		}
	</div>
</div>

<div id="share">
	<button type="button" class="shareBtn progressindicator_share"><i class="anticon anticon-share-alt"></i> Share </button>
</div>

<div id="commentsAmountHeaderID" data-id="@Model.CommentsAmount.ToString()">
	@Model.CommentsAmount Comments
</div>
<div>
	<button id="@string.Format("{0}_{1}", "resourceLikes" , Model.Id.ToString())" type="button" class="addLike anticon anticon-like-o" data-id="@Model.Id.ToString()" title="Add Like"> <span>@Model.Likes.Likes</span> </button>
	<button id="@string.Format("{0}_{1}", "resourceDislikes" , Model.Id.ToString())" type="button" class="addDislike anticon anticon-dislike-o" data-id="@Model.Id.ToString()" title="Add Dislike"> <span>@Model.Likes.Dislikes</span> </button>
</div>


<div>

	@if (Model.UserAuthorized)
	{
		<div id="@string.Format("{0}_{1}", "commentsBlock", Model.Id.ToString())">
			<div class="replyAddComment">
				<div class="textarea-container">
					<textarea placeholder="Add a comment…" name="commentName" id="@string.Format("{0}_{1}", "comment", Model.Id.ToString())"></textarea>
				</div>
				<button type="button" class="addCommentBtn" data-id="@Model.Id.ToString()"> Add Comment </button>
			</div>
		</div>
	}
</div>


<div id="commentsAmountBottomID" data-id="@Model.CommentsAmount.ToString()">
	@Model.CommentsAmount Comments
</div>
<div id="refTable">
	@Html.Partial("_IAFCHBComments", Model.Comments)
</div>

<div>
	<p>More Resources in <span>@Model.ResourceDetails.Category.CategoryTitle</span></p>
</div>

<div>
	<ul>
		@foreach (var item in Model.MoreResources)
		{
			<li>
				<div>
					@item.ResourceDetails.ResourceType
				</div>
				<div>
					<a href='@item.ResourceUrl'>@item.ResourceDetails.ResourceTitle</a>
				</div>
				<div>
					<button title="Add Like" id="@string.Format("{0}_{1}", "resourceLikes" , item.Id.ToString())" type="button" class="addLike anticon anticon-like-o" data-id="@item.Id.ToString()"> <span>@item.Likes.Likes</span> </button>
					<button title="Add Dislike" id="@string.Format("{0}_{1}", "resourceDislikes" , item.Id.ToString())" type="button" class="addDislike anticon anticon-dislike-o" data-id="@item.Id.ToString()"> <span>@item.Likes.Dislikes</span> </button>
				</div>
			</li>
		}
	</ul>
</div>
<div>
	<a href='@Model.ResourceDetails.Category.MyHandBookCategoryUrl'>See More</a>
</div>


<script>

	$(document).ready(function () {
		bindEdit();
	});
	

	function bindEdit() {
		//Add Like
		$('.addLike').click(function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddLike", "IAFCHBMyHandBookResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#resourceLikes_" + resourceId).html(response);
				}
			});
		});

		//Add Dislike
		$('.addDislike').click(function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddDislike", "IAFCHBMyHandBookResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#resourceDislikes_" + resourceId).html(response);
				}
			});
		});

		//Mark As Complete
		$('.markAsCompleteBtn').click(function () {

			var resourceId = $(this).attr('data-id');
			var tag_id = "#markAsComplete_" + resourceId;

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("MarkAsComplete", "IAFCHBMyHandBookResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					if (response == true) {
						$(tag_id).html("<span class='resources--plus anticon anticon-check'></span>Completed");
					}
				}
			});
		});

		//Add Comment
		$('.addCommentBtn').click(function () {

			var resourceId = $(this).attr('data-id');
			var commentMsg = $('#comment_' + resourceId).val();
			var comment = commentMsg;
			var commentAmount = parseInt($('#commentsAmountHeaderID').attr('data-id')) + 1;

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddComment", "IAFCHBMyHandBookResourceDetailsController")',
				data: { commentTxt: comment, resourceId: resourceId },
				success: function (commentsResults) {
					$("#refTable").removeData();
					$("#refTable").html(commentsResults);
					var inputTxt = $('#comment_' + resourceId);
					inputTxt.replaceWith(inputTxt.val('').clone(true));
					$("#commentsAmountHeaderID").html((commentAmount).toString() + " comments");
					$("#commentsAmountBottomID").html((commentAmount).toString() + " comments");
					bindEdit();
				}
			});			
		});

		//Add Comment Like
		$('.addCommentLike').click(function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddCommentLike", "IAFCHBMyHandBookResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#commentLikes_" + resourceId).html(response);
				}
			});			
		});

		//Add Comment Dislike
		$('.addCommentDislike').click(function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddCommentDislike", "IAFCHBMyHandBookResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#commentDislikes_" + resourceId).html(response);
				}
			});
		});

		//Comment Reply btn t1
		$('.commentReplyBtn').click(function () {

			var commentId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("PressReplyCommentBtn", "IAFCHBMyHandBookResourceDetailsController")',
				data: { commentId: commentId },
				success: function (response) {
					$("#replyCommentBtn_" + commentId).html("");
					$("#commentRepliesInputView_" + commentId).html(response);
					bindEdit();
				}
			});			
		});

		//Add Reply Comment Button Pressed
		$('.addReplyCommentBtn').click(function () {

			var commentId = $(this).attr('data-id');
			var commentMsg = $('#replyComment_' + commentId).val();
			var comment = commentMsg;

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddReplyComment", "IAFCHBMyHandBookResourceDetailsController")',
				data: { commentTxt: comment, commentId: commentId },
				success: function (commentsResults) {
					$("#commentRepliesInputView_" + commentId).html(" ");
					$("#commentRepliesView_" + commentId).html(commentsResults);
					$("#replyCommentBtn_" + commentId).html('<button type="button" class="commentReplyBtn" data-id="' + commentId + '"> Reply </button>');
					bindEdit();
				}
			});			
		});

		//share
		$('.shareBtn').click(function () {

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("Share", "IAFCHBMyHandBookResourceDetailsController")',
				dataType: "json",
				success: function (response) {
					if (response == true) {
						$('#share').html("Shared");
					}
				}
			});
		});
	}


</script>
