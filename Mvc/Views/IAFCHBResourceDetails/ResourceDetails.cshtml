@model SitefinityWebApp.Mvc.Models.IAFCHandBookResourceModel
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

<div><a href="@Model.ResourceDetails.Category.ParentCategoryUrl"><span>@Model.ResourceDetails.Category.ParentCategoryTitle</span></a> > <a href="@Model.ResourceDetails.Category.CategoryUrl"><span>@Model.ResourceDetails.Category.CategoryTitle</span></a> > @Model.ResourceTitle </div>
<table>
	<tr>
		<td style="width:70%">
			<table>
				<tr>
					<td>
						@if (Model.ResourceDetails.VideoEmbedCode != null && Model.ResourceDetails.VideoEmbedCode != String.Empty)
						{
							<iframe width="420" height="315"
									src=@Model.ResourceDetails.VideoEmbedCode></iframe>
						}
					</td>
				</tr>
				<tr>
					<td>
						<div>@Model.ResourceDetails.ResourceTitle</div>
						<div>@Model.ResourceDetails.ResourceDescription</div>
					</td>
				</tr>
				<tr>
					<td>
						<div id="@string.Format("{0}_{1}", "addToMyHandBook" , Model.Id.ToString())">
							<div id="addToMyHandBook">
								@if (Model.AddToMyHandBook == true)
								{
									<span>Added to MyHandBook</span>
								}
								else
								{
									<button type="button" class="addToMyHandBook" data-id="@Model.Id.ToString()"> +Add to MyHandBook </button>
								}
							</div>
						</div>
					</td>
					<td>
						Share
					</td>
					<td>
						@Model.CommentsAmount Comments
					</td>

					<td>
						<button type="button" class="addLike" data-id="@Model.Id.ToString()"> Add Like </button>
						<div id="@string.Format("{0}_{1}", "resourceLikes" , Model.Id.ToString())">
							<span>@Model.Likes.Likes</span>
						</div>
					</td>
					<td>
						<button type="button" class="addDislike" data-id="@Model.Id.ToString()"> Add Dislike </button>
						<div id="@string.Format("{0}_{1}", "resourceDislikes" , Model.Id.ToString())">
							<span>@Model.Likes.Dislikes</span>
						</div>
					</td>
				</tr>
				<tr>

					<td>
						
						<div id="@string.Format("{0}_{1}","commentsBlock", Model.Id)">
							<div class="AddComment">
							<div>
									<textarea 
										   cols="40" 
										   rows ="5" 
										   style="width:700px; height:100px"
										   name="commentName"
										   id="@string.Format("{0}_{1}", "comment", Model.Id.ToString())" 
										   value="">
									</textarea>
								</div>
								<button type="button" class="addCommentBtn" data-id="@Model.Id.ToString()"> Add Comment </button>
							</div>
						</div>
					</td>
				</tr>

				
				<tr>
					<td>
						<div id="refTable">
							
						</div>
					</td>

				</tr>


			</table>			
		</td>
		<td style="width:30%">
			<table>
				<tr>
					<td>
						More Resources in <span>@Model.ResourceDetails.Category.CategoryTitle</span>
					</td>
				</tr>
				@foreach (var item in Model.MoreResources)
				{
					<tr>
						<td>
							@item.ResourceDetails.ResourceType
						</td>
					</tr>
					<tr>
						<td>
							<a href='@item.ResourceUrl'>@item.ResourceDetails.ResourceTitle</a>
						</td>
					</tr>
					<tr>
						<td>
							<button type="button" class="addLike" data-id="@item.Id.ToString()"> Add Like </button>
							<div id="@string.Format("{0}_{1}", "resourceLikes" , item.Id.ToString())">
								<span>@item.Likes.Likes</span>
							</div>
						</td>
						<td>
							<button type="button" class="addDislike" data-id="@item.Id.ToString()"> Add Dislike </button>
							<div id="@string.Format("{0}_{1}", "resourceDislikes" , item.Id.ToString())">
								<span>@item.Likes.Dislikes</span>
							</div>
						</td>
					</tr>

				}
				<tr>
					<td>
						<a href='@Model.ResourceDetails.Category.CategoryUrl'>See More</a>
					</td>
				</tr>
			</table>
		</td>
	</tr>
</table>


<script type="text/javascript">

	$(document).ready(function () {

		//Add Like
		$('.addLike').on('click', function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				url: '@Url.Action("AddLike", "IAFCHBResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#resourceLikes_" + resourceId).html(response);
				}
			});
		});

		//Add Dislike
		$('.addDislike').on('click', function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				url: '@Url.Action("AddDislike", "IAFCHBResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#resourceDislikes_" + resourceId).html(response);
				}
			});
		});

		//Add ToMyHandBook
		$('.addToMyHandBook').on('click', function () {

			var resourceId = $(this).attr('data-id');
			var tag_id = "#addToMyHandBook_" + resourceId;
			
			$.ajax({
				type: 'POST',
				url: '@Url.Action("AddToMyHandBook", "IAFCHBResourceDetailsController")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {										
					if (response == true) {						
						$(tag_id).html("Added to MyHandBook");
					}					
				}
			});
		});

		//Add Comment
		$('.addCommentBtn').on('click', function () {

			var resourceId = $(this).attr('data-id');
			var commentMsg = $('#comment_' + resourceId).val();
			var comment = commentMsg;

			$.ajax({
				type: 'POST',
				url: '@Url.Action("AddComment", "IAFCHBResourceDetailsController")',
				data: { commentTxt: comment, resourceId:resourceId },
				success: function (commentsResults) {
					$("#refTable").removeData();
					$("#refTable").html(commentsResults);
					var inputTxt = $('#comment_' + resourceId);
					inputTxt.replaceWith(inputTxt.val('').clone(true));
				}

			});
		});
		
	});


</script>
