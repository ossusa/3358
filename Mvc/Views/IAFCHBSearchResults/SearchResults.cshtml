@model  SitefinityWebApp.Mvc.Models.IAFCHandBookSearchedResourcesModel

<div class="search-results box">
	<div class="breadcrumbs">Search</div>
	@if (Model.Resources.Any())
	{
	<div class="handbook-title">
		<h1> Search Results For &nbsp; "<span id="searchTextVal">@Model.SearchText</span>"</h1>
	</div>
	}
	else
	{
	<div class="handbook-title">
		<h1> 0 No results for"<span id="searchTextVal">@Model.SearchText</span>"</h1>
	</div>
	}

	<div id="detailsViewID">
		@Html.Partial("_SearchResultsDetails", Model)
	</div>
</div>

<script>
	$(document).ready(function () {

		bindEdit();
	});

	function bindEdit() {

		//Add Like
		$('.addLike').click(function () {
			var isAdding = true;
			var likeAddamount = 1;
			var resourceId = $(this).attr('data-id');
			var isDisLikeEnabled = $('#resourceDisLikesBtn_' + resourceId).is(':disabled');
			if (isDisLikeEnabled) {
				isAdding = false;
				likeAddamount = -1;
				$("#resourceDisLikesBtn_" + resourceId).removeAttr('disabled');
			}
			else {
				$("#resourceDisLikesBtn_" + resourceId).attr('disabled', 'disabled');
			}

			var likesAmmount = $(this).attr('data-id1');
			var newResult = parseInt(likesAmmount) + likeAddamount;
			$("#resourceLikes_" + resourceId).html(newResult);
			var likesAmmount = $(this).attr('data-id1',newResult);


			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddLike", "IAFCHBMyHandBookCategoryResources")',
				data: { resourceId: resourceId, isAdding: isAdding },
				dataType: "json",
				success: function (response) {
					console.log(response)
				}
			});
		});

		//Add Dislike
		$('.addDislike').click(function () {
			var isAdding = true;
			var dislikeAddamount = 1;
			var resourceId = $(this).attr('data-id');
			var isLikeEnabled = $('#resourceLikesBtn_' + resourceId).is(':disabled');

			if (isLikeEnabled) {
				isAdding = false;
				var dislikeAddamount = -1;
				$("#resourceLikesBtn_" + resourceId).removeAttr('disabled');
			}
			else {
				$("#resourceLikesBtn_" + resourceId).attr('disabled', 'disabled');
			}

			var disLikesAmmount = $(this).attr('data-id1');
			var newLDilsikeResult = parseInt(disLikesAmmount) + dislikeAddamount;
			$("#resourceDislikes_" + resourceId).html(newLDilsikeResult);
			disLikesAmmount = $(this).attr('data-id1', newLDilsikeResult);

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddDislike", "IAFCHBMyHandBookCategoryResources")',
				data: { resourceId: resourceId, isAdding: isAdding },
				dataType: "json",
				success: function (response) {
					console.log(response)
				}
			});
		});

		//Add ToMyHandBook
		$('.addToMyHandBookBtn').click(function () {

			var resourceId = $(this).attr('data-id');
			var orderBy = $('#orderByList').val();
			var searchText = document.getElementById("searchTextVal").innerText;
			
			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddToMyHandBook", "IAFCHBMyHandBookCategoryResources")',
				data: { resourceId: resourceId, searchText: searchText, orderBy: orderBy},				
				success: function (response) {										
					$("#detailsViewID").html(response);
					bindEdit();			
				}
			});
		});

		//mark As Complete
		$('.markAsCompleteBtn').click(function ()  {

			var resourceId = $(this).attr('data-id');			

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("MarkAsComplete", "IAFCHBMyHandBookCategoryResources")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {					
					if (response == true) {
						$('#markAsComplete_' + resourceId).html('<div class="complete_box anticon anticon-check"></div>Complete');
					}
				}
			});			
		});

		//Open Resource Details
		$('.resourceLink').click(function () {
			var resourceUrl = $(this).attr("data-id");
			var resourceLinkUrl = $(this).attr('data-id1');
			var resourceDocumentUrl = $(this).attr('data-id2');
			var openResourceDocumentUrl = $(this).attr('data-id3');

			if (openResourceDocumentUrl == "OpenLink") {
				window.location.href = resourceUrl;
			}
			else if (resourceLinkUrl != 'undefined' && resourceLinkUrl != "") {
				window.open(resourceLinkUrl);
			}
			else if (resourceDocumentUrl != 'undefined' && resourceDocumentUrl != "") {
				window.open(resourceDocumentUrl);
			}
		});

	}

	function doOrderBy() {
		var orderBy = $('#orderByList').val();
		var searchText = document.getElementById("searchTextVal").innerText;

		$.ajax({
			type: 'POST',
			cache: false,
			url: '@Url.Action("OrderBy", "IAFCHBSearchResultsController")',
			data: { searchText: searchText, orderBy: orderBy  },
			success: function (response) {
				$("#detailsViewID").html(response);
				bindEdit();
			}
		});
	}

</script>