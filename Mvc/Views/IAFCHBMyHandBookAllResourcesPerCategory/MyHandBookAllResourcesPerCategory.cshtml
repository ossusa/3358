@model  SitefinityWebApp.Mvc.Models.IAFCHandBookMyHandBookModel
<div class="handbook__title">
	<h1>MY HANDBOOK</h1>
</div>

<div class="box">
	@foreach (var myHandBookResource in Model.MyHandBookResurces)
	{
	<div class="community_indicator_col">
		<div class="topic__title">@myHandBookResource.Category.CategoryTitle</div>

		<div class="handbook__social-buttons">
			@if (Model.SharedUserId == Guid.Empty)
			{
				<button id="edit" type="button" class="editBtn progressindicator_share"><i class="anticon anticon-setting"></i> Edit </button>
				<button id="edit" type="button" class="cancelBtn progressindicator_share"><i class="anticon anticon-setting"></i> Cancel </button>
				<button id="share" type="button" class="shareBtn progressindicator_share"><i class="anticon anticon-share-alt"></i> Share </button>
			}
		</div>

	</div>
		<div>
			@foreach (var myChildResources in myHandBookResource.MyChildHandBookResources)
			{
				<div id="@string.Format("{0}_{1}", "myHandBookResourcesDetails", myChildResources.Category.Id.ToString())">
					@Html.Partial("_MyHandBookAllResourcesPerCategoryDetails", myChildResources)
				</div>
				<br />
			}
		</div>
	
	}	
</div>

<script src="/Sitefinity/WebsiteTemplates/IAFCHandBook/App_Themes/IAFCHandBook/js/jquery.selectric.js"></script>

<script type="text/javascript">

	$(document).ready(function () {
		$('.removeResource').hide();		
		$('.cancelBtn').hide();
		bindEdit();
	});
	$(document).ajaxComplete(function (event, xhr, settings) {
		bindEdit();
	});

	function bindEdit(){

		//Add Like
		$('.addLike').one('click', function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddLike", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#resourceLikes_" + resourceId).html(response);
				}
			});
		});

		//Add Dislike
		$('.addDislike').one('click', function () {

			var resourceId = $(this).attr('data-id');

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddDislike", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {
					$("#resourceDislikes_" + resourceId).html(response);
				}
			});
		});

		//mark As Complete
		$('.markAsCompleteBtn').one('click', function () {

			var resourceId = $(this).attr('data-id');
			var categoryId = $(this).attr('data-id2');			

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("MarkAsComplete", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: {  resourceId: resourceId, categoryId: categoryId},
				success: function (response) {					
					$('#myHandBookResourcesDetails_' + categoryId).html(response);
					hideButtons();
				}
			});
		});

		//remove
		$('.removeBtn').one('click', function () {

			var resourceId = $(this).attr('data-id');
			var categoryId = $(this).attr('data-id2');			

			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("Remove", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { resourceId: resourceId, categoryId: categoryId },
				success: function (response) {					
					$('#myHandBookResourcesDetails_' + categoryId).html(response);
					hideButtons();
				}
			});
		});

		//Add Shared Resource to My Hand Book
		$('.addSharedToMyHandBookBtn').one('click', function () {
			var resourceId = $(this).attr('data-id');			
			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("AddSharedToMyHandBook", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { resourceId: resourceId },
				dataType: "json",
				success: function (response) {					
					if (response == true) {
						$("#addSharedToMyHandBook_" + resourceId).html("<span class='resources--plus anticon anticon-check'></span>Added to MyHandBook");
					}
				}
			});
		});


		//Edit
		$('.editBtn').one('click', function () {			
			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("Edit", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { operation: "Edit" },
				dataType: "json",
				success: function (response) {
					if (response == true) {
						$('.editBtn').hide();
						$('.cancelBtn').show();
					}
					
					hideButtons();
				}
			});
		});

		//Cancel
		$('.cancelBtn').one('click', function () {
			
			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("Edit", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { operation: "Cancel" },
				dataType: "json",
				success: function (response) {
					if (response == false) {
						$('.editBtn').show();
						$('.cancelBtn').hide();
					}					
					hideButtons();
				}
			});
		});

		//share
		$('.shareBtn').one('click', function () {
			var url = window.location.href;
			$.ajax({
				type: 'POST',
				cache: false,
				url: '@Url.Action("Share", "IAFCHBMyHandBookAllResourcesPerCategory")',
				data: { url: url },
				dataType: "json",
				success: function (response) {
					$('#share').html(response);
				}
			});
		});
	}

	function hideButtons() {
		var isEditVisible = $('.editBtn').is(':visible');
		if (isEditVisible) {
			$('.markAsCompleteResource').show();
			$('.removeResource').hide();			
		}
		else {
			$('.markAsCompleteResource').hide();
			$('.removeResource').show();			
		}
	}

</script>
